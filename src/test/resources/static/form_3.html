<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Ký Khám Bệnh</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            margin: 50px auto;
        }
        .form-group label {
            font-weight: bold;
        }
        .btn-calculate {
            background-color: #28a745;
            color: white;
        }
        .btn-refresh {
            background-color: #ffc107;
            color: white;
        }
        .btn-exit {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="form-container">
        <h2 class="text-center text-primary mb-4">Đăng Ký Khám Bệnh</h2>
        <form id="registrationForm" novalidate>
            <div class="form-group">
                <label for="name">Họ Tên:</label>
                <input type="text" class="form-control" placeholder="Nhập họ tên" id="name" required minlength="3" maxlength="50"
                       pattern="^[a-zA-ZÀÁẢÃẠÂẤẦẨẪẬĂẮẶÊẾỀỂỄỆÔỐỒỔỖỘƠỚỜỞỠỢĐ ]+$">
                <div class="invalid-feedback" data-test="name-error">
                    Họ tên phải có độ dài từ 3 đến 50 ký tự và không chứa số hoặc ký tự đặc biệt.
                </div>
            </div>
            <div class="form-group">
                <label for="address">Địa Chỉ:</label>
                <input type="text" class="form-control" id="address" required minlength="5" maxlength="100" placeholder="Nhập địa chỉ">
                <div class="invalid-feedback">Địa chỉ phải có độ dài từ 5 đến 100 ký tự và không rỗng.</div>
            </div>
            <div class="form-group">
                <label for="phone">Số Điện Thoại:</label>
                <input type="tel" class="form-control" id="phone" required placeholder="Nhập số điện thoại (0123 456 789)">
                <div class="invalid-feedback">Số điện thoại phải hợp lệ (10-15 chữ số) và không chứa ký tự đặc biệt.</div>
            </div>
            <div class="form-group">
                <label for="cccd">Số CCCD:</label>
                <input type="text" class="form-control" id="cccd" required pattern="^\d{12}$" placeholder="Nhập số CCCD (12 chữ số)">
                <div class="invalid-feedback">Số CCCD phải gồm đúng 12 chữ số và không chứa ký tự không phải số.</div>
            </div>
            <div class="form-group">
                <label>Giới Tính:</label>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="gender" id="male" value="Nam" required>
                    <label class="form-check-label" for="male">Nam</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="gender" id="female" value="Nữ">
                    <label class="form-check-label" for="female">Nữ</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="gender" id="child" value="Trẻ em">
                    <label class="form-check-label" for="child">Trẻ em</label>
                </div>
                <div class="form-check">
                    <input type="radio" class="form-check-input" name="gender" id="elder" value="Người cao tuổi">
                    <label class="form-check-label" for="elder">Người cao tuổi</label>
                </div>
                <div class="invalid-feedback">Vui lòng chọn giới tính.</div>
            </div>
            <div class="form-group">
                <label for="age">Tuổi:</label>
                <input type="number" class="form-control" id="age" required min="0" max="120" placeholder="Nhập tuổi (0-120)">
                <div class="invalid-feedback">Tuổi phải nằm trong khoảng 0-120.</div>
            </div>
            <div class="form-group">
                <label for="doctor">Chọn Bác Sĩ:</label>
                <select class="form-control" id="doctor" required>
                    <option value="">Chọn bác sĩ</option>
                    <option>Bác Sĩ 1</option>
                    <option>Bác Sĩ 2</option>
                    <option>Bác Sĩ 3</option>
                </select>
                <div class="invalid-feedback">Vui lòng chọn bác sĩ.</div>
            </div>
            <div class="form-group">
                <label for="appointment">Thời Gian Khám:</label>
                <input type="datetime-local" class="form-control" id="appointment" required>
                <div class="invalid-feedback">Vui lòng chọn thời gian khám.</div>
            </div>
            <div class="form-group">
                <label for="fee">Giá Tiền:</label>
                <input type="text" class="form-control" id="fee" value="VND" readonly>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-calculate" id="payment">Tính Tiền</button>
                <button type="reset" class="btn btn-refresh">Làm Mới</button>
                <button type="submit" class="btn btn-primary">Đăng Ký</button>
                <button type="button" class="btn btn-exit">Thoát</button>
            </div>
        </form>
    </div>
</div>

<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- jQuery and JavaScript -->
<script>
    $(document).ready(function() {
        //xử lý định dạng lại khi paste vào phone
        document.getElementById('phone').addEventListener('paste', function (e) {
            e.preventDefault();
            let pasteData = (e.clipboardData || window.clipboardData).getData('text');
            pasteData = pasteData.replace(/\D/g, '').slice(0, 10); // Giới hạn tối đa 10 số
            let formattedValue = '';
            if (pasteData.length > 0) {
                formattedValue = pasteData.slice(0, 4);
            }
            if (pasteData.length >= 5) {
                formattedValue += ' ' + pasteData.slice(4, 7);
            }
            if (pasteData.length >= 8) {
                formattedValue += ' ' + pasteData.slice(7, 10);
            }
            e.target.value = formattedValue;
        });

        // Function to calculate fee based on gender and age
        function calculateFee(gender, age) {
            let fee = 0;
            if (gender === "Nam") {
                if (age >= 17 && age <= 20) {
                    fee = 100;
                } else if (age >= 21 && age <= 30) {
                    fee = 120;
                } else if (age >= 31 && age <= 60) {
                    fee = 200;
                } else if (age > 60) {
                    fee = 250;
                } else {
                    return null; // Invalid age for "Nam"
                }
            } else if (gender === "Nữ") {
                if (age >= 17 && age <= 20) {
                    fee = 90;
                } else if (age >= 21 && age <= 30) {
                    fee = 120;
                } else if (age >= 31 && age <= 60) {
                    fee = 140;
                } else if (age > 60) {
                    fee = 150;
                } else {
                    return null; // Invalid age for "Nữ"
                }
            } else if (gender === "Trẻ em") {
                if (age >= 0 && age < 17) {
                    fee = 50;
                } else {
                    return null; // Invalid age for "Trẻ em"
                }
            } else if (gender === "Người cao tuổi") {
                if (age > 60) {
                    fee = 200; // Average fee for elderly
                } else {
                    return null; // Invalid age for "Người cao tuổi"
                }
            } else {
                return null; // Undefined gender
            }
            return fee;
        }
        // ** Form validation on input change then hightlight field when validate
        $("#registrationForm input, #registrationForm select").on("input change", function() {
            const input = $(this);
            if (input[0].checkValidity()) {
                input.removeClass("is-invalid").addClass("is-valid");
            } else {
                input.removeClass("is-valid").addClass("is-invalid");
            }
        });

        // Handle the calculate button
        $(".btn-calculate").on("click", function() {
            const form = $("#registrationForm")[0];

            // Reset previous validation states
            form.classList.remove('was-validated');

            // Get form values
            const gender = $('input[name="gender"]:checked').val();
            const age = parseInt($("#age").val(), 10);

            // Validate required fields before calculation
            if (!gender || isNaN(age)) {
                form.classList.add('was-validated');
                alert("Vui lòng điền đầy đủ thông tin hợp lệ!");
                return;
            }
            // Calculate the fee
            const fee = calculateFee(gender, age);

            if (fee !== null) {
                $("#fee").val(fee + " VND");
                alert("Giá tiền ước tính: " + fee + " VND");
            } else {
                // If fee calculation returns null, it means invalid age for the selected gender
                alert("Tuổi không hợp lệ cho giới tính đã chọn. Vui lòng kiểm tra lại thông tin!");
            }
        });

        // Handle form submission
        $("#registrationForm").on("submit", function(event) {
            const form = this;
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
                form.classList.add('was-validated');
            } else {
                // Optionally, handle form data submission here
                alert("Đăng ký thành công!");
            }
        });

        // Input validation
        $('input, select').on('input change', function() {
            this.setCustomValidity(''); // Reset custom validation message
            if (this.validity.patternMismatch) {
                this.setCustomValidity('Giá trị không hợp lệ!');
            }
            if (this.validity.rangeUnderflow) {
                this.setCustomValidity('Giá trị quá nhỏ!');
            }
            if (this.validity.rangeOverflow) {
                this.setCustomValidity('Giá trị quá lớn!');
            }
        });
        // Handle the exit button
        $(".btn-exit").on("click", function() {
            if (confirm("Bạn có chắc chắn muốn thoát?")) {
                window.close(); // Will only work for windows opened via JS
            }
        });
    });
</script>
</body>
</html>
